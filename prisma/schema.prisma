generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  userName     String?  @unique
  name         String
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  instagramAccounts InstagramAccount[]

  @@map("User")
}

model InstagramAccount {
  id                String  @id @default(uuid())
  instagramId       String  @unique
  instagramUserName String?
  accountType       String?
  facebookPageId    String?

  accessToken          String?
  pageAccessToken      String?
  accessTokenExpiresAt DateTime?
  grantedScopes        String?

  // ✅ NOVO: usado pelo TokenStore
  lastRefreshedAt DateTime?

  // ✅ flag de vínculo (conectado/desconectado)
  isConnected Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("InstagramAccounts")
}
