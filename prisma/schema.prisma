generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  userName     String?  @unique
  name         String
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relação com as contas de Instagram
  instagramAccounts InstagramAccount[]
}

model InstagramAccount {
  // Campos principais
  id                String  @id @default(uuid()) @map("Id")
  ownerUserId       String? @map("OwnerUserId")
  instagramId       String? @unique @map("InstagramId")
  instagramUserName String? @map("InstagramUserName")
  facebookPageId    String? @map("FacebookPageId")

  // Tokens e escopos
  accessToken          String?   @map("AccessToken")
  pageAccessToken      String?   @map("PageAccessToken")
  accessTokenExpiresAt DateTime? @map("AccessTokenExpiresAt")
  grantedScopes        String?   @map("GrantedScopes")

  // Datas de controle
  lastRefreshedAt DateTime? @map("LastRefreshedAt")
  createdAt       DateTime  @default(now()) @map("CreatedAt")
  updatedAt       DateTime  @updatedAt @map("UpdatedAt")

  // Relação com User (equivalente ao OwnerUserId do sistema antigo)
  userId String? @map("UserId")
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("InstagramAccounts") // nome físico da tabela no banco
}
